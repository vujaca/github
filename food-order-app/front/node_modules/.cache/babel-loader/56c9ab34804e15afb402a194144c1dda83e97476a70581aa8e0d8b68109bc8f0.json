{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajko Andjic\\\\Desktop\\\\Repository\\\\github\\\\food-order-app\\\\front\\\\src\\\\pages\\\\Authentication.js\";\nimport Login from \"../components/authorization/Login\";\nimport Axios from '../apis/Axios';\nimport jwt_decode from 'jwt-decode';\nimport { json, redirect } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthenticationPage = () => {\n  return /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 7,\n    columnNumber: 12\n  }, this);\n};\n_c = AuthenticationPage;\nexport default AuthenticationPage;\nexport async function action(_ref) {\n  let {\n    request\n  } = _ref;\n  const searchParams = new URL(request.url).searchParams;\n  const mode = searchParams.get('mode') || 'login';\n  const isLogin = mode === 'login';\n  if (mode !== 'login' && mode !== 'signup') {\n    throw json({\n      message: 'Unsupported mode.'\n    }, {\n      status: 422\n    });\n  }\n  const data = await request.formData();\n  let url = '/korisnici/auth';\n  let cred = {\n    username: data.get('username'),\n    password: data.get('password')\n  };\n  if (data.get('name') || data.get('surname') || data.get('email')) {\n    cred = {\n      username: data.get('username'),\n      email: data.get('email'),\n      name: data.get('name'),\n      surname: data.get('surname'),\n      password: data.get('password')\n    };\n    url = '/korisnici';\n  }\n  try {\n    const response = await Axios.post(url, cred);\n    const jwt_decoded = jwt_decode(response.data);\n    localStorage.setItem('jwt', response.data);\n    {\n      isLogin ? localStorage.setItem('role', jwt_decoded.role.authority) : localStorage.setItem('role', 'ROLE_KORISNIK');\n    }\n    const expiration = new Date();\n    expiration.setHours(expiration.getHours() + 1);\n    localStorage.setItem('expiration', expiration.toISOString());\n    return redirect('/');\n  } catch (error) {\n    if (error.response.status === 422 || error.response.status === 401) {\n      return error.response.data;\n    }\n    if (error.response.status === 405) {\n      let response = error.response.data;\n      response.message = 'Internal Server Error!';\n      return response;\n    }\n    if (error.response.status !== 200) {\n      let response = error.response.data;\n      response.message = 'Something went wrong!';\n      return response;\n    }\n  }\n}\nvar _c;\n$RefreshReg$(_c, \"AuthenticationPage\");","map":{"version":3,"names":["Login","Axios","jwt_decode","json","redirect","jsxDEV","_jsxDEV","AuthenticationPage","fileName","_jsxFileName","lineNumber","columnNumber","_c","action","_ref","request","searchParams","URL","url","mode","get","isLogin","message","status","data","formData","cred","username","password","email","name","surname","response","post","jwt_decoded","localStorage","setItem","role","authority","expiration","Date","setHours","getHours","toISOString","error","$RefreshReg$"],"sources":["C:/Users/Rajko Andjic/Desktop/Repository/github/food-order-app/front/src/pages/Authentication.js"],"sourcesContent":["import Login from \"../components/authorization/Login\"\r\nimport Axios from '../apis/Axios';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { json, redirect } from 'react-router-dom';\r\n\r\nconst AuthenticationPage = () => {\r\n    return <Login/>\r\n\r\n}\r\nexport default AuthenticationPage;\r\n\r\nexport async function action({request}) {\r\n    const searchParams = new URL(request.url).searchParams\r\n    const mode = searchParams.get('mode') || 'login'\r\n    const isLogin = mode === 'login'\r\n    if(mode !== 'login' && mode !== 'signup') {\r\n        throw json({message: 'Unsupported mode.'}, {status: 422})\r\n    }\r\n\r\n    const data = await request.formData()\r\n\r\n    let url = '/korisnici/auth'\r\n    let cred = {\r\n        username: data.get('username'),\r\n        password: data.get('password')\r\n    }\r\n\r\n    if(data.get('name') || data.get('surname') || data.get('email')){\r\n        cred= {\r\n            username: data.get('username'),\r\n            email: data.get('email'),\r\n            name: data.get('name'),\r\n            surname: data.get('surname'),\r\n            password: data.get('password')\r\n        }\r\n        url = '/korisnici'\r\n    }\r\n    \r\n\r\n        try {\r\n            const response = await Axios.post(url, cred)\r\n            const jwt_decoded = jwt_decode(response.data)\r\n            localStorage.setItem('jwt', response.data)\r\n            {isLogin ? localStorage.setItem('role', jwt_decoded.role.authority) :  localStorage.setItem('role', 'ROLE_KORISNIK')}\r\n            const expiration = new Date()\r\n            expiration.setHours(expiration.getHours()+1)\r\n            localStorage.setItem('expiration', expiration.toISOString())\r\n            return redirect('/')   \r\n        } catch (error) {\r\n            if (error.response.status === 422|| error.response.status === 401) {\r\n                return error.response.data\r\n              }\r\n            if(error.response.status === 405) {\r\n                let response = error.response.data\r\n                response.message='Internal Server Error!'\r\n                return response\r\n            }\r\n              if (error.response.status !== 200) {\r\n                let response = error.response.data\r\n                response.message='Something went wrong!'\r\n                return response\r\n              }\r\n        }\r\n    \r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}